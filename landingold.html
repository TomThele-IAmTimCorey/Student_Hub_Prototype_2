<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Hub Landing 6</title>
  
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header, footer { background-color: #222; color: white; padding: 15px; text-align: center; }
    .container { padding: 20px; }
    h2 { margin-top: 40px; }
    .badges img { height: 100px; margin-right: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 8px; border: 1px solid #ddd; text-align: left; }
    button { padding: 6px 12px; }
    .two-column { display: flex; gap: 20px; flex-wrap: wrap; }
    .section { flex: 1 1 45%; margin-bottom: 20px; }
  </style>
</head>
<body>
  <header>
    <h1>Student Hub</h1>
    <p>Navigation Bar (replicate as needed)</p>
  </header>

  <div class="container">
    <h2 id="welcomeText">Welcome In</h2>

    <!-- Section 1: Badges -->
    <div class="section">
      <h2>My Badges</h2>
      <div class="badges">
        <img src="https://irp.cdn-website.com/ebe5b67e/dms3rep/multi/Sample+Completion+Badge.png" alt="Badge 1">
        <img src="https://images.credly.com/images/5ce74333-7dab-48c5-8e20-c8f489ec6e6c/image.png" alt="Badge 2">
        <img src="https://studentengagement.ie/wp-content/uploads/2022/01/NStEP-Digital-Badges-Academic-Representation.png" alt="Badge 3">
      </div>
    </div>

      <!-- Debug output area -->
  <div id="debugOutput" style="color: #c00; margin-bottom: 10px;"></div>

    <!-- Section 2: Courses -->
    <div id="coursesContainer"></div>
  </div>

  <script>
    document.getElementById('welcomeText').textContent =
      "Welcome In, " + (localStorage.getItem('login_name') || "Student");

    const loginEmail = localStorage.getItem('login_email');
    function debugLog(msg) {
  const debugDiv = document.getElementById('debugOutput');
  debugDiv.innerHTML += `<div>${msg}</div>`;
}
    document.getElementById('debugOutput').innerHTML = "";

    async function loadCourses() {
      const container = document.getElementById('coursesContainer');
      const apiKey = "hoUy238I3tditABq22vkjWxEUoylKigb"; // Use your actual key

      // Starting Try attempt for API call
      debugLog(`Starting API call for ${loginEmail}`);
      console.log(`Starting API call for ${loginEmail}`); 
          
      try {
        const response = await fetch("https://developers.teachable.com/v1/users", {
          method: "POST",
          headers: {
            "accept": "application/json",
            "content-type": "application/json",
            "apikey": apiKey
          },
          body: JSON.stringify({ email: loginEmail })
        });

        if (!response.ok) {
          throw new Error("API request failed: " + response.status);
        }
        const data = await response.json(); 

        // Finished Try attempt for API call
      debugLog(`Finished API call for ${loginEmail}`);
      console.log(`Finished API call for ${loginEmail}`);

        const courses = (data.courses || []).filter(c => c.is_active_enrollment);

        if (!courses.length) {
          container.innerHTML = `No enrollments found for ${loginEmail}`;
          return;
        }

        // Show raw response for debugging
        debugLog(`<pre>${JSON.stringify(data, null, 2)}</pre>`); 
        console.log("API response data:", data);  
        
        
        // Sort courses by percent_complete descending
        courses.sort((a, b) => b.percent_complete - a.percent_complete);

        // Build table
        let tableHtml = `<table>
          <tr><th>Course Name</th><th>Progress</th><th>Action</th></tr>`;
        courses.forEach(c => {
          let btnLabel = "Not Started";
          if (c.percent_complete === 100) btnLabel = "Review";
          else if (c.percent_complete > 0) btnLabel = "In Progress";

          tableHtml += `<tr>
            <td>${c.course_name}</td>
            <td>${c.percent_complete}%</td>
            <td><a href="https://courses.iamtimcorey.com/courses/enrolled/${c.course_id}" target="_blank">
              <button>${btnLabel}</button>
            </a></td>
          </tr>`;
        });
        tableHtml += "</table>";
        container.innerHTML = tableHtml;

      } catch (err) {
        console.error(err);
        container.innerHTML = `Error loading courses for ${loginEmail}`;
      }
    }
 // ...existing code...

loadCourses(); 

  </script>
  <h3>Table should be above this</h3>
</body>
</html>