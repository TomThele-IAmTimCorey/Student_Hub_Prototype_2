<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Hub Landing 3.0</title>
  
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header, footer { background-color: #222; color: white; padding: 15px; text-align: center; }
    .container { padding: 20px; }
    h2 { margin-top: 40px; }
    .badges img { height: 100px; margin-right: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 8px; border: 1px solid #ddd; text-align: left; }
    button { padding: 6px 12px; }
    .bento-wrapper {
      background: #39bad8;
      border-radius: 24px;
      padding: 32px 16px;
      margin-top: 32px;
      margin-bottom: 32px;
      box-shadow: 0 4px 16px rgba(57,186,216,0.10);
    }
    .bento-box {
      background: #f8f8f8;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      padding: 24px;
      margin-bottom: 32px;
    }
    .video-thumbs {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: flex-start;
      align-items: flex-start;
    }
    .video-thumb {
      text-align: center;
      width: 200px;
    }
    .video-thumb img {
      width: 100%;
      border-radius: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.10);
      margin-bottom: 8px;
    }
    @media (max-width: 700px) {
      .video-thumbs { flex-direction: column; align-items: stretch; }
      .video-thumb { width: 100%; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Student Hub</h1>
    <p>Navigation Bar (replicate as needed)</p>
  </header>

  <div class="container">
    <h2 id="welcomeText">Welcome In</h2>

    <div class="bento-wrapper">
      <!-- Section 1: Badges -->
      <div class="bento-box">
        <h2>My Badges</h2>
        <div class="badges">
          <a href="https://bcert.me/sjvhrtrsj"><img src="https://bcert.me/bc/html/img/badges/generated/badge-67772.png" alt="Badge 1"></a>
          <a href="https://bcert.me/ssvlggkvd"><img src="https://bcert.me/bc/html/img/badges/generated/badge-67775.png" alt="Badge 2"></a>
        </div>
        <button class="btn btn-success" onclick="window.open('https://badgecert.com/login','_blank')">
          Login to BadgeCert
        </button>
        <span>Log into your profile to share your badges on social media!</span>
      </div>

      <!-- Section 2: Courses -->
      <div class="bento-box">
        <h2>My Courses</h2>
        <div id="coursesContainer"></div>
      </div>

      <!-- Section 3: Tim's newest video -->
      <div class="bento-box">
        <h2>Tim's newest video</h2>
        <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:12px;">
          <iframe src="https://www.youtube.com/embed/sTDcUwfzCsA?si=vNbu85GmQ4pO5E4Z"
                  title="Tim's newest video"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                  style="position:absolute;top:0;left:0;width:100%;height:100%;border-radius:12px;">
          </iframe>
        </div>
      </div>

      <!-- Section 4: More videos -->
      <div class="bento-box">
        <h2>More Videos</h2>
        <div class="video-thumbs">
          <div class="video-thumb">
            <a href="https://youtu.be/fgqm46iR8VI?si=z4iuI1wODohlt4UH" target="_blank">
              <img src="https://img.youtube.com/vi/fgqm46iR8VI/hqdefault.jpg" alt="Video 1 Thumbnail">
              <div>How to Learn C# (2024)</div>
            </a>
          </div>
          <div class="video-thumb">
            <a href="https://youtu.be/3Hl3k87UvpY?si=ligoUItAEb2re7Hn" target="_blank">
              <img src="https://img.youtube.com/vi/3Hl3k87UvpY/hqdefault.jpg" alt="Video 2 Thumbnail">
              <div>How to Learn SQL (2024)</div>
            </a>
          </div>
          <div class="video-thumb">
            <a href="https://youtu.be/ZJTbHEP3smU?si=_ezBSKKEJvFymr1i" target="_blank">
              <img src="https://img.youtube.com/vi/ZJTbHEP3smU/hqdefault.jpg" alt="Video 3 Thumbnail">
              <div>How to Learn .NET MAUI (2024)</div>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('welcomeText').textContent =
      "Welcome In, " + (localStorage.getItem('login_name') || "Student");

    const loginEmail = localStorage.getItem('login_email');

    async function loadCourses() {
      const container = document.getElementById('coursesContainer');
      const apiKey = "hoUy238I3tditABq22vkjWxEUoylKigb"; // Use your actual key

      console.log(`Starting API call for ${loginEmail}`); 
          
      try {
        const response = await fetch("https://developers.teachable.com/v1/users/81034898", {
          method: "GET",
          headers: {
            "accept": "application/json",
            "apikey": "hoUy238I3tditABq22vkjWxEUoylKigb"
          }
        });

        if (!response.ok) {
          throw new Error("API request failed: " + response.status);
        }
        const data = await response.json(); 

        const courses = (data.courses || []).filter(c => c.is_active_enrollment);

        if (!courses.length) {
          container.innerHTML = `No enrollments found for ${loginEmail}`;
          return;
        }

        // Sort courses by percent_complete descending
        courses.sort((a, b) => b.percent_complete - a.percent_complete);

        // Build table
        let tableHtml = `<table>
          <tr><th>Course Name</th><th>Progress</th><th>Action</th></tr>`;
        courses.forEach(c => {
          let btnLabel = "Not Started";
          if (c.percent_complete === 100) btnLabel = "Review";
          else if (c.percent_complete > 0) btnLabel = "In Progress";

          tableHtml += `<tr>
            <td>${c.course_name}</td>
            <td>${c.percent_complete}%</td>
            <td><a href="https://courses.iamtimcorey.com/courses/enrolled/${c.course_id}" target="_blank">
              <button>${btnLabel}</button>
            </a></td>
          </tr>`;
        });
        tableHtml += "</table>";
        container.innerHTML = tableHtml;

      } catch (err) {
        console.error(err);
        container.innerHTML = `Error loading courses for ${loginEmail}`;
      }
    }

    loadCourses(); 
  </script>
</body>
</html>